"""
Модуль утилит для работы с PDF файлами.

Содержит функции для извлечения текстового содержимого из PDF документов.
Используется в процессе анализа документов для подготовки текста к обработке
системами искусственного интеллекта.

Основные функции:
    extract_text_from_pdf: Извлекает текст со всех страниц PDF документа

Зависимости:
    pypdf.PdfReader: Парсер PDF файлов для извлечения текстового содержимого
    logging: Модуль для логирования ошибок и информации о работе
"""

from pypdf import PdfReader
import logging


logger = logging.getLogger(__name__)


def extract_text_from_pdf(file_path: str) -> str:
    """
    Извлекает текстовое содержимое из PDF файла.

    Функция читает PDF файл, последовательно обрабатывает каждую страницу
    и извлекает текстовое содержимое. Текст со всех страниц конкатенируется
    с разделением переносами строк.

    Args:
        file_path: Путь к PDF файлу на диске

    Returns:
        str: Текстовое содержимое документа со всех страниц,
             объединенное в одну строку

    Raises:
        FileNotFoundError: Если указанный файл не существует
        PermissionError: Если нет прав на чтение файла
        Exception: Общее исключение при ошибках чтения или парсинга PDF
                   с сообщением "Не удалось извлечь текст из PDF: {error}"

    Note:
        - Функция открывает файл в бинарном режиме чтения ('rb')
        - Каждая страница обрабатывается методом extract_text()
        - После каждой страницы добавляется перенос строки '\n'
        - Конечный результат обрезается от лишних пробелов (strip())
        - Все исключения логируются с уровнем ERROR
    """

    try:
        with open(file_path, 'rb') as file:
            pdf_reader = PdfReader(file)
            text = ""

            for page in pdf_reader.pages:
                text += page.extract_text() + "\n"

            return text.strip()
    except Exception as e:
        logger.error(f"Ошибка при извлечении текста из PDF: {str(e)}")
        raise Exception(f"Не удалось извлечь текст из PDF: {str(e)}")

"""
Модуль для извлечения текста из PDF-файлов.

Этот модуль предоставляет функционал для чтения PDF-документов и извлечения текстового
содержимого со всех страниц. Модуль предназначен для интеграции в системы
обработки документов, где требуется преобразование PDF в текст для последующего
анализа или хранения.

Основная функция:
    extract_text_from_pdf(file_path: str) -> str
        Извлекает текст из PDF-файла по указанному пути

Исключения:
    Генерирует общее исключение Exception с описанием ошибки в случае проблем
    при чтении файла или извлечении текста

Логирование:
    Использует стандартный логгер Python для записи ошибок при обработке PDF

Пример использования:
    ```python
    try:
        text = extract_text_from_pdf("/path/to/document.pdf")
        print(f"Извлечен текст длиной {len(text)} символов")
    except Exception as e:
        print(f"Ошибка: {e}")
    ```

Зависимости:
    PyPDF2>=3.0.0 - для работы с PDF файлами

Ограничения:
    - Не поддерживает OCR для сканированных документов
    - Может некорректно обрабатывать PDF со сложным форматированием
    - Не извлекает изображения, таблицы или медиа-контент
"""

import PyPDF2
import logging


logger = logging.getLogger(__name__)


def extract_text_from_pdf(file_path: str) -> str:
    """
    Извлекает текстовое содержимое из PDF-файла.

    Процесс:
        1. Открытие PDF-файла в бинарном режиме
        2. Инициализация объекта PdfReader для чтения документа
        3. Последовательное извлечение текста с каждой страницы
        4. Конкатенация текста всех страниц с разделением переносами строк
        5. Очистка и возврат итогового текста

    Аргументы:
        file_path (str): Путь к PDF-файлу на диске.
            Файл должен существовать и быть доступным для чтения.
            Пример: "/path/to/document.pdf"

    Возвращает:
        str: Текст, извлеченный из PDF-файла.
            - Текст со всех страниц объединяется в одну строку
            - Каждая страница завершается символом новой строки
            - Возвращаемая строка очищается от начальных и конечных пробелов

    Исключения:
        FileNotFoundError: Если файл по указанному пути не существует
        PermissionError: Если нет прав на чтение файла
        PyPDF2.errors.PdfReadError: Если файл поврежден или не является валидным PDF
        Exception: Любые другие ошибки при обработке PDF

    Особенности:
        - Использует PyPDF2.PdfReader для чтения PDF (поддерживает PDF 1.4-1.7)
        - Обрабатывает все страницы документа последовательно
        - Автоматически закрывает файл после обработки (контекстный менеджер)
        - Логирует ошибки с детальной информацией для диагностики

    Требования:
        - Установленная библиотека PyPDF2
        - Доступ к файловой системе для чтения указанного файла

    Пример использования:
        try:
            text = extract_text_from_pdf("/documents/report.pdf")
            print(f"Извлечено {len(text)} символов")
        except Exception as e:
            print(f"Ошибка: {e}")

    Примечания:
        - Функция может неэффективно работать с очень большими PDF-файлами
        - Качество извлечения текста зависит от структуры PDF-документа
        - Изображения, сканированные документы и защищенные PDF не поддерживаются
        - Для оптимизации памяти при работе с большими файлами рассмотрите
          потоковую обработку страниц
    """

    try:
        with open(file_path, 'rb') as file:
            pdf_reader = PyPDF2.PdfReader(file)
            text = ""

            for page in pdf_reader.pages:
                text += page.extract_text() + "\n"

            return text.strip()
    except Exception as e:
        logger.error(f"Ошибка при извлечении текста из PDF: {str(e)}")
        raise Exception(f"Не удалось извлечь текст из PDF: {str(e)}")
